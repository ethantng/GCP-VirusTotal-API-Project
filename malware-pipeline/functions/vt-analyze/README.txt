GCP & VirusTotal API Integration Project

Purpose: This project is a Google Cloud–based pipeline for analyzing suspicious files/URLs using Cloud Functions and Workflows.  

Architecture:
malware-pipeline/
├─ functions/
│ └─ vt-analyze/
│ ├─ main.py # Cloud Function entrypoint
│ ├─ requirements.txt # Python dependencies
│ └─ README.md # Function-specific notes
└─ workflows/
└─ vt-orchestrator.yaml # Workflow orchestrator definition

Cloud Function: `vt-analyze`
- **Language**: Python 3.12  
- **Entrypoint**: `entry` function in `main.py`  
- **Trigger**: HTTP  
- **Purpose**: Handles analysis requests (e.g., sending URLs/files to VirusTotal or another scanning service).  

Deployment:
```bash
gcloud functions deploy vt-analyze \
  --gen2 \
  --runtime=python312 \
  --region=us-central1 \
  --entry-point=entry \
  --trigger-http \
  --service-account=functions-sa@<PROJECT_ID>.iam.gserviceaccount.com \
  --set-env-vars="GCP_PROJECT=<PROJECT_ID>,GCP_REGION=us-central1" \
  --source=functions/vt-analyze \
  --no-allow-unauthenticated\

Testing:
TOKEN=$(gcloud auth print-identity-token \
  --impersonate-service-account=workflows-sa@<PROJECT_ID>.iam.gserviceaccount.com \
  --audiences="$(gcloud run services describe vt-analyze --region=us-central1 --format='value(status.url)')")

curl -X POST "$(gcloud run services describe vt-analyze --region=us-central1 --format='value(status.url)')" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"type":"url","value":"https://httpbin.org/get"}'